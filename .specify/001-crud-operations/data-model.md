# Data Model: CRUD Operations for Posts

**Feature**: CRUD Operations for Posts  
**Branch**: `001-crud-operations`  
**Date**: 2026-02-27

## Overview

This document defines all data entities, their relationships, validation rules, and state transitions for CRUD operations. All entities are derived from functional requirements in spec.md and align with the existing Post type structure.

---

## Core Entities

### 1. Post (Existing - Enhanced)

**Description**: Represents a complete social media post with all associated metadata, engagement metrics, and content.

**Source**: `src/types/post.types.ts` (existing)

**Attributes**:

| Attribute  | Type                | Required | Description                              | Validation                              |
| ---------- | ------------------- | -------- | ---------------------------------------- | --------------------------------------- |
| id         | number              | Yes      | Unique post identifier                   | Positive integer, auto-generated by API |
| userId     | number              | Yes      | ID of user who created the post          | Positive integer, defaults to 1         |
| title      | string              | Yes      | Post title/headline                      | 1-255 characters, trimmed               |
| body       | string              | Yes      | Main post content                        | 1-5000 characters, trimmed              |
| engagement | Engagement          | Yes      | Metrics object (likes, comments, shares) | Valid Engagement object                 |
| isLiked    | boolean             | Yes      | Whether current user liked the post      | Boolean, defaults to false              |
| timestamp  | Date                | Yes      | Creation/update timestamp                | Valid Date object, auto-generated       |
| hashtags   | string[]            | Yes      | Extracted hashtags from content          | Array of strings, auto-extracted        |
| imageUrl   | string \| undefined | No       | Optional image URL                       | Valid URL or undefined                  |
| user       | User \| undefined   | No       | Optional user details                    | Valid User object or undefined          |

**Relationships**:

- One Post belongs to one User (via userId)
- One Post has one Engagement object
- One Post has zero or more hashtags

**State Transitions**:

```
[Draft/New] --create--> [Created] --update--> [Updated] --delete--> [Deleted]
```

---

### 2. CreatePostRequest (New)

**Description**: Data Transfer Object (DTO) for creating a new post. Contains only user-provided fields.

**Source**: `src/types/post.types.ts` (to be added)

**Attributes**:

| Attribute | Type   | Required | Description       | Validation                            |
| --------- | ------ | -------- | ----------------- | ------------------------------------- |
| title     | string | Yes      | Post title        | 1-255 characters, trimmed, not empty  |
| body      | string | Yes      | Post content      | 1-5000 characters, trimmed, not empty |
| userId    | number | Yes      | Creator's user ID | Positive integer, defaults to 1       |

**Validation Rules**:

- Title must not be empty after trimming whitespace
- Title length: minimum 1, maximum 255 characters
- Body must not be empty after trimming whitespace
- Body length: minimum 1, maximum 5000 characters
- userId must be a positive integer

**Derived Fields** (Auto-generated on submission):

- id: Assigned by API (or temporary ID for optimistic update)
- engagement: Initialized to `{ likes: 0, comments: 0, shares: 0 }`
- isLiked: Initialized to `false`
- timestamp: Set to `new Date()`
- hashtags: Extracted from body using regex `/#(\w+)/g`
- imageUrl: Set to `undefined`
- user: Set to `undefined` or fetched separately

**TypeScript Definition**:

```typescript
export interface CreatePostRequest {
  title: string;
  body: string;
  userId: number;
}
```

---

### 3. UpdatePostRequest (New)

**Description**: DTO for updating an existing post. Contains post ID and fields to be updated.

**Source**: `src/types/post.types.ts` (to be added)

**Attributes**:

| Attribute | Type   | Required | Description          | Validation                            |
| --------- | ------ | -------- | -------------------- | ------------------------------------- |
| id        | number | Yes      | ID of post to update | Positive integer, must exist          |
| title     | string | Yes      | Updated title        | 1-255 characters, trimmed, not empty  |
| body      | string | Yes      | Updated content      | 1-5000 characters, trimmed, not empty |

**Validation Rules**:

- Same validation as CreatePostRequest for title and body
- id must reference an existing post (validated in context layer)

**Derived Fields** (Updated on submission):

- timestamp: Updated to `new Date()`
- hashtags: Re-extracted from updated body
- engagement, isLiked, userId, imageUrl, user: Preserved from original post

**Note**: JSONPlaceholder API supports both PUT (full replacement) and PATCH (partial update). We use PATCH for efficiency.

**TypeScript Definition**:

```typescript
export interface UpdatePostRequest {
  id: number;
  title: string;
  body: string;
}
```

---

### 4. DeletePostRequest (New)

**Description**: Minimal DTO containing only the post ID to be deleted.

**Source**: `src/types/post.types.ts` (to be added)

**Attributes**:

| Attribute | Type   | Required | Description          | Validation                   |
| --------- | ------ | -------- | -------------------- | ---------------------------- |
| id        | number | Yes      | ID of post to delete | Positive integer, must exist |

**Validation Rules**:

- id must reference an existing post (validated in context layer)
- Deletion is irreversible (user must confirm via dialog)

**TypeScript Definition**:

```typescript
export interface DeletePostRequest {
  id: number;
}

// Or simply use: (postId: number) parameter in function signature
```

---

### 5. PostFormData (New)

**Description**: Local form state used within PostForm and PostDialog components. Includes validation error state.

**Source**: `src/hooks/usePostForm.ts` (to be added)

**Attributes**:

| Attribute    | Type          | Required | Description                                   |
| ------------ | ------------- | -------- | --------------------------------------------- |
| title        | string        | Yes      | Form input for title                          |
| body         | string        | Yes      | Form input for body                           |
| errors       | FormErrors    | Yes      | Validation errors object                      |
| touched      | TouchedFields | Yes      | Tracks which fields have been interacted with |
| isSubmitting | boolean       | Yes      | Loading state during submission               |

**Supporting Types**:

```typescript
export interface FormErrors {
  title?: string;
  body?: string;
  submit?: string; // General submission error
}

export interface TouchedFields {
  title: boolean;
  body: boolean;
}

export interface PostFormData {
  title: string;
  body: string;
  errors: FormErrors;
  touched: TouchedFields;
  isSubmitting: boolean;
}
```

**State Transitions**:

```
[Empty] --user input--> [Dirty] --blur--> [Touched] --submit--> [Submitting] --success/error--> [Empty/Error]
```

---

### 6. Engagement (Existing)

**Description**: Engagement metrics for a post.

**Source**: `src/types/post.types.ts` (existing)

**Attributes**:

| Attribute | Type   | Required | Description        | Validation           |
| --------- | ------ | -------- | ------------------ | -------------------- |
| likes     | number | Yes      | Number of likes    | Non-negative integer |
| comments  | number | Yes      | Number of comments | Non-negative integer |
| shares    | number | Yes      | Number of shares   | Non-negative integer |

**Initialization**: All fields default to `0` for new posts.

---

### 7. User (Existing)

**Description**: User information associated with a post.

**Source**: `src/types/post.types.ts` (existing)

**Attributes**:

| Attribute | Type   | Required | Description            |
| --------- | ------ | -------- | ---------------------- |
| id        | number | Yes      | Unique user identifier |
| name      | string | Yes      | Full name              |
| username  | string | Yes      | Username               |
| email     | string | Yes      | Email address          |

**Note**: For CRUD operations, we assume userId = 1 (no authentication context). User details may be undefined for newly created posts.

---

## Validation Rules Summary

### Client-Side Validation

All validation occurs before API calls to provide immediate feedback.

#### Title Validation

```typescript
function validateTitle(title: string): ValidationResult {
  const trimmed = title.trim();

  if (trimmed.length === 0) {
    return { isValid: false, error: 'Title is required' };
  }

  if (trimmed.length > 255) {
    return { isValid: false, error: 'Title must be 255 characters or less' };
  }

  return { isValid: true };
}
```

#### Body Validation

```typescript
function validateBody(body: string): ValidationResult {
  const trimmed = body.trim();

  if (trimmed.length === 0) {
    return { isValid: false, error: 'Post content is required' };
  }

  if (trimmed.length > 5000) {
    return {
      isValid: false,
      error: 'Post content must be 5000 characters or less',
    };
  }

  return { isValid: true };
}
```

#### Character Counting

- Display: `${currentLength} / ${maxLength} characters`
- Warning threshold: Show yellow text when > 90% of limit
- Error threshold: Disable submit when at or over limit

---

## Entity Relationships Diagram

```
┌─────────────────────┐
│       User          │
│  ─────────────────  │
│  + id: number       │
│  + name: string     │
│  + username: string │
│  + email: string    │
└──────────┬──────────┘
           │ 1
           │ creates
           │
           │ *
┌──────────▼──────────┐         ┌─────────────────┐
│       Post          │ 1     1 │   Engagement    │
│  ─────────────────  │◄────────┤  ─────────────  │
│  + id: number       │         │  + likes: num   │
│  + userId: number   │         │  + comments: n  │
│  + title: string    │         │  + shares: num  │
│  + body: string     │         └─────────────────┘
│  + engagement       │
│  + isLiked: bool    │
│  + timestamp: Date  │
│  + hashtags: str[]  │
│  + imageUrl?: str   │
│  + user?: User      │
└─────────────────────┘
           │
           │ derives
           │
    ┌──────┴──────┬──────────────┬────────────────┐
    │             │              │                │
┌───▼──────┐ ┌───▼──────┐ ┌─────▼──────┐ ┌──────▼──────┐
│  Create  │ │  Update  │ │   Delete   │ │  FormData   │
│  Request │ │  Request │ │  Request   │ │             │
│  ───────│ │  ───────│ │  ───────  │ │  ─────────│
│  +title  │ │  +id     │ │  +id       │ │  +title     │
│  +body   │ │  +title  │ └────────────┘ │  +body      │
│  +userId │ │  +body   │                │  +errors    │
└──────────┘ └──────────┘                │  +touched   │
                                          └─────────────┘
```

---

## Data Flow

### Create Post Flow

```
User Input (PostForm)
  └─> PostFormData { title, body, errors, touched, isSubmitting }
      └─> validate()
          ├─> [Invalid] Show errors, prevent submit
          └─> [Valid] Create CreatePostRequest { title, body, userId }
              └─> PostsContext.createPost()
                  ├─> Optimistic Update: Add temp post to state
                  └─> api.service.createPost(request)
                      ├─> [Success] Replace temp post with API response
                      └─> [Error] Remove temp post, show error, keep form data
```

### Update Post Flow

```
User clicks Edit
  └─> Open PostDialog (mode='edit', initialValues=post)
      └─> PostForm pre-filled with post.title, post.body
          └─> User edits, validate()
              └─> Create UpdatePostRequest { id, title, body }
                  └─> PostsContext.updatePost()
                      ├─> Optimistic Update: Modify post in state
                      └─> api.service.updatePost(request)
                          ├─> [Success] Confirm update in state
                          └─> [Error] Revert to original post, show error
```

### Delete Post Flow

```
User clicks Delete
  └─> Open DeleteConfirmDialog
      └─> User confirms
          └─> PostsContext.deletePost(postId)
              ├─> Optimistic Update: Remove post from state
              └─> api.service.deletePost(postId)
                  ├─> [Success] Confirm deletion
                  └─> [Error] Restore post to state, show error
```

---

## State Management

### PostsContext State

```typescript
interface PostsState {
  posts: Post[];
  loading: boolean;
  error: string | null;
  // New for CRUD:
  creatingPost: boolean;
  updatingPostId: number | null;
  deletingPostId: number | null;
}
```

### Operation States

| Operation | Loading State       | Success Action                | Error Action                         |
| --------- | ------------------- | ----------------------------- | ------------------------------------ |
| Create    | creatingPost = true | Add post to array, reset flag | Reset flag, show error               |
| Update    | updatingPostId = id | Modify post, reset flag       | Revert post, reset flag, show error  |
| Delete    | deletingPostId = id | Remove post, reset flag       | Restore post, reset flag, show error |

---

## Hashtag Extraction Logic

**Algorithm**: Extract all words prefixed with `#` from post body.

**Regex**: `/#(\w+)/g`

**Examples**:

- Input: `"Check out this #amazing post #react #typescript"`
- Output: `["amazing", "post", "react", "typescript"]`

**Notes**:

- Case preserved from original text
- Only alphanumeric characters and underscores (no special chars or spaces in hashtags)
- Duplicates preserved (can be deduplicated if needed)

---

## Persistence Layer Notes

### JSONPlaceholder API Behavior

- **POST /posts**: Returns created post with new ID (simulated, not persisted)
- **PATCH /posts/:id**: Returns updated post (simulated, not persisted)
- **DELETE /posts/:id**: Returns empty object (simulated, not persisted)

**Implication**: All changes are client-side only. State is lost on page refresh. For production, integrate with real backend API.

**Workaround for Demo**: Consider adding localStorage persistence layer to maintain state across sessions.

---

## Next Steps

With data model defined, proceed to:

1. Create API contracts in `contracts/api-contracts.md`
2. Create component interfaces in `contracts/component-contracts.md`
3. Create developer quickstart guide in `quickstart.md`
